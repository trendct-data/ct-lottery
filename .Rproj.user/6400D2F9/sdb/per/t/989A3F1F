{
    "contents" : "# Lottery analysis\n\nlibrary(RCurl)\nlibrary(stringr)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(gridExtra)\nlibrary(tidyr)\nlibrary(trendct)\n\n# gross sales https://data.ct.gov/Government/Lottery-Gross-Sales-Prizes-Agent-Commissions-And-T/sdpj-q7rw\n# gross <- \"https://data.ct.gov/api/views/sdpj-q7rw/rows.csv?accessType=DOWNLOAD\"\n# gross <- getURL(gross,.opts=list(ssl.verifypeer=FALSE))\n# gross <- read.csv(textConnection(gross))\ngross <- read.csv(\"lottery_gross.csv\", stringsAsFactors=FALSE)\n\n# transfers gaming https://data.ct.gov/Government/Transfers-to-the-State-General-fund-from-Gaming/j6mp-nsv2\ntransfers_gaming <- \"https://data.ct.gov/api/views/j6mp-nsv2/rows.csv?accessType=DOWNLOAD\"\ntransfers_gaming <- getURL(transfers_gaming,.opts=list(ssl.verifypeer=FALSE))\ntransfers_gaming <- read.csv(textConnection(transfers_gaming))\n\n# sales https://data.ct.gov/Government/Lottery-Sales-By-Game/n9q9-yvd6\nsales <- \"https://data.ct.gov/api/views/n9q9-yvd6/rows.csv?accessType=DOWNLOAD\"\nsales <- getURL(sales,.opts=list(ssl.verifypeer=FALSE))\nsales <- read.csv(textConnection(sales))\n\n# licenses https://data.ct.gov/Business/State-Licenses-and-Credentials/ngch-56tr\nlicenses <- \"https://data.ct.gov/api/views/ngch-56tr/rows.csv?accessType=DOWNLOAD\"\nlicenses <- getURL(licenses,.opts=list(ssl.verifypeer=FALSE))\nlicenses <- read.csv(textConnection(licenses))\n\n# GROSS analysis\n\ngross$Gross.Sales <- gsub(\"\\\\$\", \"\", gross$Gross.Sales)\ngross$Gross.Sales <- gsub(\",\", \"\", gross$Gross.Sales)\ngross$Gross.Sales <- as.numeric(as.character(gross$Gross.Sales))\n\ngross$Prizes <- gsub(\"\\\\$\", \"\", gross$Prizes)\ngross$Prizes <- gsub(\",\", \"\", gross$Prizes)\ngross$Prizes <- as.numeric(as.character(gross$Prizes))\n\ngross$Agent.Commissions <- gsub(\"\\\\$\", \"\", gross$Agent.Commissions)\ngross$Agent.Commissions <- gsub(\",\", \"\", gross$Agent.Commissions)\ngross$Agent.Commissions <- as.numeric(as.character(gross$Agent.Commissions))\n\ngross$Transfers.to.the.General.Fund <- gsub(\"\\\\$\", \"\", gross$Transfers.to.the.General.Fund)\ngross$Transfers.to.the.General.Fund <- gsub(\",\", \"\", gross$Transfers.to.the.General.Fund)\ngross$Transfers.to.the.General.Fund <- as.numeric(as.character(gross$Transfers.to.the.General.Fund))\n\ngross$Percent <- gsub(\"\\\\%\", \"\", gross$Percent)\ngross$Percent <- as.numeric(as.character(gross$Percent))\n\ngross$Total <- gross$Prizes+gross$Agent.Commissions+gross$Transfers.to.the.General.Fund\n\ngross$Game <- as.factor(gross$Game)\n\ngross_prizes <- gross %>%\n  select(Fiscal.Year, Game, Prizes) %>%\n  filter(Game!=\"Total\")\n\nggplot(data=gross_prizes, aes(x=Fiscal.Year, y=Prizes, group=Game, colour=Game)) +\n  geom_line() +\n  geom_point()\n\ngross_prizes <- gross %>%\n  select(Fiscal.Year, Game, Prizes) %>%\n  filter(Game!=\"Total\")\n\ngross_prizes_chart <- ggplot(data=gross_prizes, aes(x=Fiscal.Year, y=Prizes, group=Game, colour=Game)) +\n  geom_line() +\n  geom_point()\n\ngross_ac <- gross %>%\n  select(Fiscal.Year, Game, Agent.Commissions) %>%\n  filter(Game!=\"Total\")\n\ngross_ac_chart <- ggplot(data=gross_ac, aes(x=Fiscal.Year, y=Agent.Commissions, group=Game, colour=Game)) +\n  geom_line() +\n  geom_point()\n\ngross_t <- gross %>%\n  select(Fiscal.Year, Game, Transfers.to.the.General.Fund) %>%\n  filter(Game!=\"Total\")\n\ngross_t_chart <- ggplot(data=gross_t, aes(x=Fiscal.Year, y=Transfers.to.the.General.Fund, group=Game, colour=Game)) +\n  geom_line() +\n  geom_point()\n\n\n# plot_grid(sp, bp, labels=c(\"A\", \"B\"), ncol = 2, nrow = 1)\n\ngrid.arrange(gross_prizes_chart, gross_ac_chart, gross_t_chart, labels=c(\"A\", \"B\"), ncol = 1, nrow = 3)\n\n# Area chart\n\np <- ggplot(gross, aes(Fiscal.Year, Prizes))\np + geom_area(aes(colour=Game, fill=Game), position='stack')\np + geom_area(aes(colour = PR_Cat, fill= PR_Cat), position = 'stack')   \n\ngross_prizes_trend <- spread(gross_prizes, Game, Prizes)\n\ntrendchart(gross_prizes_trend, headline = \"Total lottery prizes by game in Connecticut\", subhead = \"\", src = \"CT Dept of Consumer Protection\",\n           byline = \"TrendCT.org\", type = \"line\", xTitle = \"\", yTitle = \"\",\n           xSuffix = \"\", ySuffix = \"\", xPrefix = \"\", yPrefix = \"$\", option = \"\")\n\ngross_t_trend <- spread(gross_t, Game, Transfers.to.the.General.Fund)\n\ntrendchart(gross_t_trend, headline = \"Total lottery contribution to Connecticut's general fund\", subhead = \"\", src = \"CT Dept of Consumer Protection\",\n           byline = \"TrendCT.org\", type = \"line\", xTitle = \"\", yTitle = \"\",\n           xSuffix = \"\", ySuffix = \"\", xPrefix = \"\", yPrefix = \"$\", option = \"\")\n\n\n## SALES\n\nsales <- sales[1:42,]\nsales$Weekly <- gsub(\"\\\\$\", \"\", sales$Weekly)\nsales$Weekly <- as.numeric(as.character(sales$Weekly))\nsales$Instant <- gsub(\"\\\\$\", \"\", sales$Instant)\nsales$Instant <- as.numeric(as.character(sales$Instant))\nsales$Daily <- gsub(\"\\\\$\", \"\", sales$Daily)\nsales$Daily <- as.numeric(as.character(sales$Daily))\nsales$Lotto <- gsub(\"\\\\$\", \"\", sales$Lotto)\nsales$Lotto <- as.numeric(as.character(sales$Lotto))\nsales$Cash5 <- gsub(\"\\\\$\", \"\", sales$Cash5)\nsales$Cash5 <- as.numeric(as.character(sales$Cash5))\nsales$Powerball <- gsub(\"\\\\$\", \"\", sales$Powerball)\nsales$Powerball <- as.numeric(as.character(sales$Powerball))\nsales$Lucky.4.Life <- gsub(\"\\\\$\", \"\", sales$Lucky.4.Life)\nsales$Lucky.4.Life <- as.numeric(as.character(sales$Lucky.4.Life))\nsales$Mega.Millions <- gsub(\"\\\\$\", \"\", sales$Mega.Millions)\nsales$Mega.Millions <- as.numeric(as.character(sales$Mega.Millions))\nsales$CSD <- gsub(\"\\\\$\", \"\", sales$CSD)\nsales$CSD <- as.numeric(as.character(sales$CSD))\nsales$Total <- gsub(\"\\\\$\", \"\", sales$Total)\nsales$Total <- as.numeric(as.character(sales$Total))\n\nsales_total <- sales %>% select(Fiscal.Year, Total)\n\ntrendchart(sales_total, headline = \"Total lottery sales in Connecticut\", subhead = \"\", src = \"CT Dept of Consumer Protection\",\n           byline = \"TrendCT.org\", type = \"line\", xTitle = \"\", yTitle = \"\",\n           xSuffix = \"\", ySuffix = \"\", xPrefix = \"\", yPrefix = \"$\", option = \"\")\n\nsales_subtotals <- sales %>% select(Fiscal.Year, Weekly, Instant, Daily, Lotto, Cash5, Powerball, Lucky.4.Life, Mega.Millions, CSD)\n\ntrendchart(sales_subtotals, headline = \"Total lottery sales by type in Connecticut\", subhead = \"\", src = \"CT Dept of Consumer Protection\",\n           byline = \"TrendCT.org\", type = \"line\", xTitle = \"\", yTitle = \"\",\n           xSuffix = \"\", ySuffix = \"\", xPrefix = \"\", yPrefix = \"$\", option = \"\")\n\n# TOTAL FROM GAMING\n\ntransfers_gaming <- transfers_gaming[1:43,]\nbackup <- transfers_gaming\ntransfers_gaming$Lottery <- gsub(\"\\\\$\", \"\", transfers_gaming$Lottery)\ntransfers_gaming$Lottery <- as.numeric(as.character(transfers_gaming$Lottery))\ntransfers_gaming$Plainfield.Greyhound <- gsub(\"\\\\$\", \"\", transfers_gaming$Plainfield.Greyhound)\ntransfers_gaming$Plainfield.Greyhound <- as.numeric(as.character(transfers_gaming$Plainfield.Greyhound))\ntransfers_gaming$Bridgeport.Shoreline.Star <- gsub(\"\\\\$\", \"\", transfers_gaming$Bridgeport.Shoreline.Star)\ntransfers_gaming$Bridgeport.Shoreline.Star <- as.numeric(as.character(transfers_gaming$Bridgeport.Shoreline.Star))\ntransfers_gaming$Hartford.Jai.Alai <- gsub(\"\\\\$\", \"\", transfers_gaming$Hartford.Jai.Alai)\ntransfers_gaming$Hartford.Jai.Alai <- as.numeric(as.character(transfers_gaming$Hartford.Jai.Alai))\ntransfers_gaming$Milford.Jai.Alai <- gsub(\"\\\\$\", \"\", transfers_gaming$Milford.Jai.Alai)\ntransfers_gaming$Milford.Jai.Alai <- as.numeric(as.character(transfers_gaming$Milford.Jai.Alai))\ntransfers_gaming$Pari.mutuel.Subtotal <- gsub(\"\\\\$\", \"\", transfers_gaming$Pari.mutuel.Subtotal)\ntransfers_gaming$Pari.mutuel.Subtotal <- as.numeric(as.character(transfers_gaming$Pari.mutuel.Subtotal))\ntransfers_gaming$Off.Track.Betting <- gsub(\"\\\\$\", \"\", transfers_gaming$Off.Track.Betting)\ntransfers_gaming$Off.Track.Betting <- as.numeric(as.character(transfers_gaming$Off.Track.Betting))\ntransfers_gaming$Charitable.Games <- gsub(\"\\\\$\", \"\", transfers_gaming$Charitable.Games)\ntransfers_gaming$Charitable.Games <- as.numeric(as.character(transfers_gaming$Charitable.Games))\ntransfers_gaming$Foxwoods <- gsub(\"\\\\$\", \"\", transfers_gaming$Foxwoods)\ntransfers_gaming$Foxwoods <- as.numeric(as.character(transfers_gaming$Foxwoods))\ntransfers_gaming$Mohegan.Sun <- gsub(\"\\\\$\", \"\", transfers_gaming$Mohegan.Sun)\ntransfers_gaming$Mohegan.Sun <- as.numeric(as.character(transfers_gaming$Mohegan.Sun))\ntransfers_gaming$Casino.Subtotal <- gsub(\"\\\\$\", \"\", transfers_gaming$Casino.Subtotal)\ntransfers_gaming$Casino.Subtotal <- as.numeric(as.character(transfers_gaming$Casino.Subtotal))\ntransfers_gaming$Grand.Total <- gsub(\"\\\\$\", \"\", transfers_gaming$Grand.Total)\ntransfers_gaming$Grand.Total <- gsub(\"\\\\,\", \"\", transfers_gaming$Grand.Total)\ntransfers_gaming$Grand.Total <- gsub(\"\\\\* \", \"\", transfers_gaming$Grand.Total)\n\ntransfers_gaming$Grand.Total <- as.numeric(as.character(transfers_gaming$Grand.Total))\n\ntransfers_total <- transfers_gaming %>% select(FYE.6.30, Lottery, Pari.mutuel.Subtotal, Off.Track.Betting, Charitable.Games, Casino.Subtotal, Grand.Total)\n\noptions(scipen=999)\n\ntransfers_total_chart <- transfers_total %>% select(FYE.6.30, Lottery, Pari.mutuel.Subtotal, Off.Track.Betting, Charitable.Games, Casino.Subtotal)\n\ntrendchart(transfers_total_chart, headline = \"Total gaming revenue by type in Connecticut\", subhead = \"\", src = \"CT Dept of Consumer Protection\",\n           byline = \"TrendCT.org\", type = \"area\", xTitle = \"\", yTitle = \"\",\n           xSuffix = \"\", ySuffix = \"\", xPrefix = \"\", yPrefix = \"$\", option = \"\")",
    "created" : 1452612856742.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "837341203",
    "id" : "989A3F1F",
    "lastKnownWriteTime" : 1452645485,
    "path" : "~/Documents/Github/lottery/lottery.R",
    "project_path" : "lottery.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "type" : "r_source"
}